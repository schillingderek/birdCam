<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>PiCamera H264 Streaming</title>
</head>
<body>
<h1>PiCamera H264 Streaming</h1>
<div id='viewer'></div>
<script src='Decoder.js'></script>
<script src='YUVCanvas.js'></script>
<script src='Player.js'></script>
<script>
  // Initialize player
  window.player = new Player({ useWorker: true, webgl: 'auto', size: { width: 640, height: 360 } });
  var playerElement = document.getElementById('viewer');
  playerElement.appendChild(window.player.canvas);

  // WebSocket setup
  var wsUri = window.location.protocol.replace(/http/, 'ws') + '//' + window.location.hostname + ':9000';
  var ws = new WebSocket(wsUri);
  ws.binaryType = 'arraybuffer';

  ws.onopen = function (e) {
    console.log('Client connected');
  };

  ws.onmessage = function (msg) {
  //console.log('Received frame of size:', msg.data.byteLength);  // Debug line
  try {
    let data = new Uint8Array(msg.data);
    //console.log('Decoded frame data:', data);  // Debug line
    window.player.decode(data);
  } catch (e) {
    //console.error('Error decoding frame:', e);  // Error handling
  }
};

  ws.onclose = function (e) {
    console.log('Client disconnected');
  };
</script>
</body>
</html>

